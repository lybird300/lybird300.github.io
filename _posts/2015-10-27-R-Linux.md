---
layout: post
title: "Using R on Centros Linux (as a cluster user)"
date: 2015-10-27
---
Although R is pretty amazing, ever since I started working on Renci clusters I've been avoiding it, because according to some of my colleagues, the installation process is painful and because the last several months I was working on really large data sets and R is not very good at dealing with them. But today I think I'm gonna give it a try.
<h2>Install R</h2>
It is said that we can install R on Redhat Linux and other Redhat like distribution spins (RENCI Hatteras uses Centros) using the "yum" command. The below command will install R along with all its prerequisites:
<pre><code>$ sudo yum install R</code></pre>
Unfortunately, I cannot use this fully automatic installation choice but have to install from R source code, because as a cluster user, I don't have root privileges to install new software on the system. I downloaded the latest source code package (looks like R-3.2.2.tar.gz) and uploaded to my home directory. Then I navigate to where I put the file and decompress it:
<pre><code>tar xzf R-3.2.2.tar.gz</code></pre>
A new directory named "R-3.2.2" is created. Navigate to this directory and execute the pre-compilation script "configure":
<pre><code>$ cd R-3.2.2
$ ./configure</code></pre>
With the "configure" script you can supply a various flags to adjust the compilation to your environment. If you do not have any special requirements you can start compilation with:
<pre><code>$ make</code></pre>
<h2>Running R</h2>
To run R under Linux from the command line. You can simply go to wherever you would like to run it (for example, where you put data files) and type "R" at the command line and press enter. Wolla, you are now in an R environment and you can type in "q()" to get out. However, this is not the major way of launching R in a cluster if you want to execute a large set of commands in sequence and allow for inputs and outputs. For these purposes, you should write an R script (let's called example.R) and run it through batch command
<pre><code>R CMD BATCH example.R</code></pre>
Or indicate the batch command in a bash file (start with "#!bin/bash"; let's call it runRexample.sh) and run the bash file
<pre><code>chmod +x runRexample.sh
./runRexample.sh</code></pre>
Since it may take a while for your R script to run, you can add an "&" in the end of your command to execute it in the background.
<h2>Use packages in R</h2>
R offers a wide variety of packages for its users. Some of them need to be additionally installed into R. A package is a set of functions, help files and data files that have been linked together. In order to use a package in R you need to first make sure that it is installed in the local library. In general, the one system-level library is used for storing the default R packages. You can, however, add additional libraries. You also need to remember about loading packages into your current R session. This is very important when using R. It is recommended that you do not load too many packages at the time. Loading a large number of packages may result in errors due to clashes of function names coming from two different packages.
As a cluster user, you can can install local copies in your home directory following several steps. First, ensure the ~/.bashrc file has the following contents:
export R_LIBS_USER=~/apps/R:$R_LIBS_USER
enter the command export R_LIBS_USER=~/apps/R:$R_LIBS_USER.
create these directories to hold your local packages: mkdir -pv ~/apps/R
for new modules, enter source new-modules.sh; module load R_packages. (for old, legacy modules, load R via: module load centos6/R-3.0.2)
at the R prompt, you should be able to install packages now: install.packages("name of package here")
you'll be prompted to select a nearby CRAN mirror
R should then install the package

<h2>References</h2>
<ul>
<li><a href="http://how-to.linuxcareer.com/introduction-to-gnu-r-on-linux-operating-system">Introduction to GNU R on Linux Operating System</a></li>
<li><a href="http://how-to.linuxcareer.com/running-gnu-r-on-linux-operating-system">Running GNU R on Linux Operating System</a></li>
<li><a href="https://rc.fas.harvard.edu/resources/documentation/software/r/">Use R via SLURM</a></li>
</ul>
